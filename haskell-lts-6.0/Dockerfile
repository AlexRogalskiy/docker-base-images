FROM phadej/ghc:7.10.3-ubuntu
MAINTAINER Oleg Grenrus <oleg.grenrus@iki.fi>

RUN apt-get -yq update && apt-get -yq --no-install-suggests --no-install-recommends --force-yes install \
    ca-certificates \
    curl \
    git \
    libfftw3-dev \
    libpq-dev \
    pkg-config \
  && rm -rf /var/lib/apt/lists/*

# Set timezone to Europe/Helsinki
RUN echo 'Europe/Helsinki' > /etc/timezone && rm /etc/localtime && ln -s /usr/share/zoneinfo/Europe/Helsinki /etc/localtime

# Set the locale
RUN locale-gen en_US.UTF-8
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8

# Install newer stack
RUN mkdir -p $HOME/.local/bin \
  && curl -L https://github.com/commercialhaskell/stack/releases/download/v1.1.2/stack-1.1.2-linux-x86_64.tar.gz | tar xz --wildcards --strip-components=1 -C /usr/bin '*/stack' \
  && stack --version

# pre build some packages
# not the whole Stackage though.
RUN stack update
RUN stack --resolver=lts-6.0 build --only-snapshot \
  DRBG \
  HUnit \
  JuicyPixels \
  JuicyPixels-scale-dct \
  MonadCatchIO-transformers \
  MonadRandom \
  QuickCheck \
  SHA \
  StateVar \
  ad \
  adjunctions \
  aeson \
  aeson-compat \
  aeson-extra \
  aeson-pretty \
  ansi-terminal \
  ansi-wl-pprint \
  appar \
  array \
  asn1-encoding \
  asn1-parse \
  asn1-types \
  async \
  attoparsec \
  attoparsec-enumerator \
  auto-update \
  base \
  base-compat \
  base-orphans \
  base-prelude \
  base-unicode-symbols \
  base16-bytestring \
  base64-bytestring \
  bifunctors \
  binary \
  binary-orphans \
  binary-tagged \
  blaze-builder \
  blaze-builder-enumerator \
  blaze-html \
  blaze-markup \
  byteable \
  byteorder \
  bytes \
  bytestring \
  bytestring-builder \
  bytestring-conversion \
  bytestring-mmap \
  carray \
  case-insensitive \
  cassava \
  cereal \
  charset \
  cipher-aes128 \
  cmdargs \
  comonad \
  composition \
  composition-extra \
  conduit \
  conduit-extra \
  connection \
  constraints \
  containers \
  contravariant \
  control-monad-omega \
  cookie \
  crypto-api \
  cryptohash \
  cryptohash-cryptoapi \
  cryptonite \
  css-text \
  data-default \
  data-default-class \
  data-default-instances-base \
  data-default-instances-containers \
  data-default-instances-dlist \
  data-default-instances-old-locale \
  data-reify \
  deepseq \
  deepseq-generics \
  dependent-map \
  dependent-sum \
  directory \
  distributive \
  dlist \
  double-conversion \
  easy-file \
  either \
  ekg \
  ekg-core \
  ekg-json \
  enclosed-exceptions \
  entropy \
  enumerator \
  erf \
  errors \
  exceptions \
  extensible-exceptions \
  fail \
  fast-logger \
  fft \
  file-embed \
  filepath \
  focus \
  free \
  generics-sop \
  ghc-prim \
  gitrev \
  hashable \
  hashable-time \
  haxl \
  hex \
  hourglass \
  hspec \
  hspec-core \
  hspec-discover \
  hspec-expectations \
  http-api-data \
  http-client \
  http-client-tls \
  http-date \
  http-link-header \
  http-media \
  http-types \
  http2 \
  integer-gmp \
  intervals \
  iproute \
  iso8601-time \
  ix-shapable \
  kan-extensions \
  keys \
  lattices \
  lens \
  lifted-base \
  linear \
  list-t \
  lucid \
  markdown \
  memory \
  mime-types \
  mmorph \
  monad-control \
  monad-logger \
  monad-loops \
  monad-time \
  monadcryptorandom \
  monads-tf \
  mtl \
  nats \
  network \
  network-uri \
  old-locale \
  old-time \
  operational \
  optparse-applicative \
  parallel \
  parallel-io \
  parsec \
  parsers \
  path \
  pem \
  pointed \
  postgresql-libpq \
  postgresql-simple \
  postgresql-simple-url \
  prelude-extras \
  pretty \
  prettyclass \
  primitive \
  process \
  profunctors \
  psqueues \
  quickcheck-instances \
  quickcheck-io \
  random \
  random-shuffle \
  recursion-schemes \
  reflection \
  regex-applicative \
  regex-applicative-text \
  regex-base \
  regex-compat \
  regex-posix \
  resource-pool \
  resourcet \
  rfc5051 \
  safe \
  scientific \
  semigroupoids \
  semigroups \
  servant \
  servant-JuicyPixels \
  servant-blaze \
  servant-cassava \
  servant-client \
  servant-docs \
  servant-lucid \
  servant-server \
  setenv \
  simple-sendfile \
  snap-core \
  snap-server \
  socks \
  split \
  stm \
  stm-chans \
  stm-containers \
  storable-complex \
  streaming-commons \
  strict \
  strict-base-types \
  string-conversions \
  stringsearch \
  syb \
  system-filepath \
  tagged \
  tagsoup \
  template-haskell \
  text \
  text-binary \
  tf-random \
  time \
  time-locale-compat \
  time-parsers \
  tls \
  transformers \
  transformers-base \
  transformers-compat \
  tz \
  tzdata \
  unexceptionalio \
  universe-base \
  universe-instances-base \
  universe-reverse-instances \
  unix \
  unix-compat \
  unix-time \
  unordered-containers \
  utf8-string \
  uuid-types \
  vault \
  vector \
  vector-binary-instances \
  vector-instances \
  void \
  wai \
  wai-app-static \
  wai-cors \
  wai-extra \
  wai-logger \
  wai-middleware-metrics \
  warp \
  word8 \
  x509 \
  x509-store \
  x509-system \
  x509-validation \
  xml-conduit \
  xml-types \
  xss-sanitize \
  yaml \
  zlib \
  zlib-bindings \
  zlib-enum \
 && echo "DONE!"
